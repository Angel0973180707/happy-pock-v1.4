<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>幸福教養｜零用錢練功房 v1.4</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-[#0a0a0c] text-gray-100 pb-28">

    <div id="topStatusBar" class="p-4 flex justify-between items-center bg-[#16161d]/90 backdrop-blur-md sticky top-0 z-50 h-24 border-b border-gray-800">
        <select id="roleSwitch" onchange="switchRole(this.value)" class="bg-black text-orange-500 font-black border-2 border-orange-500 rounded-lg px-2 py-1 text-base outline-none cursor-pointer">
            <option value="child">👶 兒童練功模式</option>
            <option value="parent">⚙️ 家長管理中心</option>
        </select>
        <div class="flex gap-4 font-black text-2xl">
            <span class="text-orange-500">$<span id="balanceDisplay">0</span></span>
            <span class="text-blue-400"><span id="pointsDisplay">0</span>P</span>
        </div>
    </div>

    <main class="p-5 max-w-md mx-auto">
        <section id="page-info" class="page-content space-y-6">
            <div class="text-center">
                <h1 class="text-3xl font-black text-orange-500 italic tracking-tighter">理智隊長修練手冊</h1>
                <p class="text-gray-500 text-sm mt-1">Version 1.4 Stable</p>
            </div>
            
            <div id="info-child-view" class="space-y-4">
                <div class="card-dark border-l-8 border-orange-600">
                    <h2 class="font-black text-xl text-orange-400 mb-2">🧠 什麼是「練功」？</h2>
                    <p class="text-base text-gray-300 leading-relaxed">當你想買東西時，「衝動隊長」會讓你變急。透過 <b>30秒冷靜</b>，把權力還給「理智隊長」。省下的錢會變成長大的<b>能量點數</b>！</p>
                </div>
                <div class="card-dark border-l-8 border-blue-600">
                    <h2 class="font-black text-xl text-blue-400 mb-2">📲 安裝到手機桌面</h2>
                    <p class="text-sm text-gray-400">點擊瀏覽器選單中的<b>「新增至主畫面」</b>，就能像真正的 App 一樣隨時練功！</p>
                </div>
            </div>

            <div id="info-parent-view" class="hidden space-y-6 text-base">
                <div class="card-dark bg-blue-900/10 border-blue-500">
                    <h3 class="font-black text-blue-400 mb-2">1. 零用錢的定義</h3>
                    <p class="text-gray-300">它是「理財的練習卷」。<b>家事是責任，嚴禁標價。</b> 讓孩子在小額時練習犯錯，避免長大後在巨款上跌倒。</p>
                </div>
                <div class="card-dark bg-purple-900/10 border-purple-500">
                    <h3 class="font-black text-purple-400 mb-2">2. 工具特色與腦科學</h3>
                    <p class="text-gray-300">前額葉發育較慢，透過<b>「30秒強制停頓」</b>，刻意強化邏輯區與慾望區的連結，訓練自律神經。</p>
                </div>
                <div class="card-dark bg-orange-900/10 border-orange-500">
                    <h3 class="font-black text-orange-400 mb-2">3. 建議給予數目 (年紀倍數法)</h3>
                    <ul class="list-disc ml-5 text-gray-300 space-y-1">
                        <li><b>低年級：</b>年級 × $10 (建立數字感)</li>
                        <li><b>高年級：</b>年級 × $20 (練習跨日分配)</li>
                        <li><b>國中：</b>年級 × $40 (練習預算規劃)</li>
                    </ul>
                </div>
                <div class="text-center p-4">
                    <p class="text-orange-500 font-black animate-bounce">👇 第一步：請先點擊「設定」進行初始化</p>
                </div>
            </div>
        </section>

        <section id="page-vault" class="page-content hidden">
            <div class="card-dark mb-6 text-center py-10 bg-gradient-to-b from-[#1a1a20] to-[#2d1e05] border-b-4 border-yellow-600">
                <p class="text-6xl font-black text-yellow-500 mb-4">$<span id="v-bal">0</span></p>
                <div class="flex justify-center gap-3">
                    <span class="bg-black/50 px-4 py-1 rounded-full text-blue-400 font-bold border border-blue-900">能量: <span id="v-saved">0</span></span>
                    <span class="bg-black/50 px-4 py-1 rounded-full text-orange-400 font-bold border border-orange-900">點數: <span id="v-pts">0</span>P</span>
                </div>
            </div>
            <div id="historyList" class="space-y-4"></div>
        </section>

        <section id="page-practice" class="page-content hidden">
            <div class="card-dark text-center p-8 min-h-[450px] flex flex-col justify-center">
                <div id="step-input" class="space-y-6">
                    <input type="text" id="itemName" class="input-dark-field text-xl" placeholder="想買什麼？">
                    <input type="number" id="itemPrice" class="input-dark-field text-4xl text-center font-black py-4" placeholder="$">
                    <button onclick="startCooldown()" class="btn-orange-dark w-full py-6 text-2xl shadow-xl">🧘 衝動消費：練功30秒</button>
                    <button onclick="quickSettle()" class="w-full py-3 text-gray-500 text-sm font-bold underline decoration-dotted">✅ 計畫性消費：直接記帳</button>
                </div>
                
                <div id="step-cooldown" class="hidden">
                    <div id="timerNum" class="text-9xl font-black text-orange-500 my-10 animate-pulse">30</div>
                    <p class="text-gray-400 text-lg italic">理智隊長正在連線中...</p>
                </div>

                <div id="step-decision" class="hidden">
                    <div class="grid grid-cols-3 gap-3 mb-8">
                        <button onclick="setMode('需要', this)" class="mode-btn text-lg">需要</button>
                        <button onclick="setMode('想要', this)" class="mode-btn text-lg">想要</button>
                        <button onclick="setMode('欲望', this)" class="mode-btn text-lg">欲望</button>
                    </div>
                    <button onclick="saveDecision(false)" class="btn-orange-dark w-full py-6 text-2xl italic">省下來，變強大！</button>
                    <button onclick="saveDecision(true)" class="w-full text-gray-500 font-bold py-4 underline">我決定購買</button>
                </div>
            </div>
        </section>

        <section id="page-settings" class="page-content hidden">
            <div id="parent-settings" class="hidden space-y-6">
                <div class="card-dark border-2 border-purple-900 shadow-[0_0_20px_rgba(168,85,247,0.2)]">
                    <h2 class="font-black text-purple-400 text-center text-2xl mb-6 tracking-widest">家長控制中心</h2>
                    <div class="space-y-5">
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-gray-400 text-sm ml-1 font-bold">初始餘額</label><input type="number" id="setBalance" class="input-dark-field mt-1 text-lg"></div>
                            <div><label class="text-gray-400 text-sm ml-1 font-bold">1P 匯率($)</label><input type="number" id="setRate" class="input-dark-field mt-1 text-lg"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-gray-400 text-sm ml-1 font-bold">利息 %</label><input type="number" id="setInterest" class="input-dark-field mt-1 text-lg"></div>
                            <div><label class="text-gray-400 text-sm ml-1 font-bold">開箱日期</label><input type="date" id="setUnboxDate" class="input-dark-field mt-1 text-lg"></div>
                        </div>
                        <button onclick="saveSettings()" class="btn-orange-dark w-full py-5 mt-4 text-xl">💾 同步教養設定</button>
                    </div>
                </div>
            </div>
            <div id="child-lock-msg" class="text-center p-24 text-gray-700 font-black text-xl italic opacity-30">🔒 家長專屬區</div>
        </section>
    </main>

    <nav class="fixed bottom-0 w-full bg-[#16161d]/95 backdrop-blur-lg border-t border-gray-800 flex justify-around p-4 z-50 h-28">
        <button onclick="showPage('info')" class="nav-item tab-active" id="nav-info">📖<span class="text-sm block mt-1">說明</span></button>
        <button onclick="showPage('vault')" class="nav-item" id="nav-vault">🍯<span class="text-sm block mt-1">金庫</span></button>
        <button onclick="showPage('practice')" class="nav-item" id="nav-practice">🧘<span class="text-sm block mt-1">練功</span></button>
        <button onclick="showPage('settings')" class="nav-item" id="nav-settings">⚙️<span class="text-sm block mt-1">設定</span></button>
    </nav>

    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('PWA Error', err));
            });
        }
    </script>
</body>
</html>
